- 源代码文件：https://disk.pku.edu.cn/link/AAC1EFF56FE6324AD9B3A44173602F3822  
- 演示视频：https://disk.pku.edu.cn/link/AA7DF33880FE0B41B9B03DC516A820E4D0
- 作业报告：https://disk.pku.edu.cn/link/AA1E5E4AF5FA3B464F848871AD7F84C9E7


# 一、程序功能介绍
## 1. 优化可视化界面

1. 同时展示已选和待选课程 ：用户可以在一个界面上清楚地看到自己已选的课程以及待选的课程列表，方便进行对比和选择。
2. 课程表可视化 ：以表格形式直观展示已选课程的时间安排，包括周一至周日的课程分布以及每节课的具体时间，帮助用户合理安排时间。
## 2. 课程筛选优化
提供了多种并列的课程筛选条件，便于用户高效快捷地找到符合条件的课程/搜索特定课程
## 3. 时间冲突提醒
高亮显示冲突课程 ：在待选课程中，若与已选课程存在时间冲突，系统会自动标红这些课程，提醒用户注意，便于时间管理

# 二、各模块与类设计细节
自定义数据结构类：course类

## 信息输入：CourseRepository 类设计详情
### 一、功能概述
CourseRepository 类是课程数据的管理仓库，主要负责从文件系统中加载课程信息，并为系统的其他模块提供统一的课程数据访问接口。它相当于整个选课系统中的数据源头，确保课程数据的准确、完整和高效读取。
### 二、详细设计
1. 数据加载
•	文件读取 ：接收文件路径参数，打开相应的课程数据文件。采用只读和文本模式读取文件内容，确保数据的完整性和安全性。
•	数据解析 ：将读取到的文件内容按行分割，逐一处理每一行数据。每行数据代表一门课程的信息，以逗号为分隔符进行字段划分，提取课程的各项属性值。
•	对象创建 ：利用解析出的字段数据，调用 Course 类的构造函数创建具体的课程对象，并将其添加到内部的课程列表中。
•	错误处理 ：在数据加载过程中，对出现的错误进行捕获和记录。例如，文件无法打开时记录错误信息并返回失败标志；数据缺失或格式错误时，跳过当前行数据并发出警告提示。
2. 数据存储
•	内部存储结构 ：内部使用一个向量（vector<Course>）来存储所有加载的课程对象。向量的动态特性使得它可以方便地容纳数量不等的课程数据，且能够高效地进行数据的增删改查操作。
•	数据更新 ：当课程数据文件发生变更时，提供方法清空旧数据并重新加载新数据，确保数据的时效性和准确性。
3. 数据访问
•	统一访问接口 ：对外提供常量引用的课程列表访问接口，使得其他模块能够安全地获取课程数据，但不能直接修改内部存储的课程列表，保证了数据的封装性和安全性。
•	数据共享 ：作为数据源，为 CourseManager 类等其他核心模块提供课程数据支持，确保整个系统中的课程数据一致性和准确性。
### 三、接口设计
1. loadFromTxt
•	功能 ：从指定文本文件加载课程数据。
•	参数 ：文件路径字符串。
•	返回值 ：布尔值，表示加载是否成功。
•	实现细节 ：打开文件，读取内容并按行分割，逐行解析数据创建课程对象，加载完成后关闭文件。过程中进行各种错误检查和处理，确保数据正确加载。
2. getCourses
•	功能 ：获取所有加载的课程数据。
•	参数 ：无。
•	返回值 ：常量引用的课程对象向量。
•	实现细节 ：直接返回内部存储课程数据的向量，供其他模块只读访问。
### 四、实现机制
1. 单例模式
•	原理 ：采用静态成员变量保存类的唯一实例，在第一次调用 getInstance 方法时创建实例，之后每次都返回该唯一实例。
•	优势 ：确保整个系统中只有一个 CourseRepository 对象，统一管理课程数据，避免数据不一致问题；同时，延迟实例化可以提高系统启动效率。
2. 数据封装
•	原理 ：将课程数据的存储和操作封装在类内部，通过成员函数对外提供有限的接口进行数据访问和操作。
•	优势 ：隐藏内部数据结构和实现细节，提高了数据的安全性和代码的可维护性；便于后续对数据存储结构和操作方式进行修改和优化，而不会影响到使用该类的其他模块。
### 五、异常处理
1. 文件操作异常
•	场景 ：当指定的课程数据文件不存在、无法打开或读取时，记录详细的错误信息，包括文件路径和错误原因。
•	处理方式 ：向调用者返回加载失败标志，提示用户检查文件路径和文件权限等问题。
2. 数据解析异常
•	场景 ：在解析文件内容时，遇到数据格式错误、字段缺失或数据类型转换失败等情况。
•	处理方式 ：记录具体的错误数据行和错误信息，跳过当前行数据继续加载后续数据，尽量保证其他正确数据的加载，避免因部分数据错误导致整个加载过程失败。
## 逻辑部分： CourseManager 与 Filter 
### Filter 
**是选课系统的智能筛选器，负责封装用户设置的课程查询条件，实现灵活精准的课程搜索功能。**
设计要点：
1. 条件封装
    包含课程类别、学分、开课单位、专业、上课教师、上课时间等多种筛选条件，统一整合为Filter类

2. 多维度时间筛选
    时间筛选条件封装在ClassTime类中，满足学生精准安排课表的需求。包括：
    1. 指定暑假有空的起始周和结束周
    2. 选择星期几有空
    3. 选择上课节次（如1-2节、3-4节）
3. 智能匹配机制
   - 数值条件为0表示不限
   - 文本为空表示不限
   - 灵活组合查询（如"查找计科院开设的3学分专业课"）

### CourseManager 是系统的选课管理中枢,负责处理核心课程数据和选课逻辑,关键功能实现：
1. 三级课程管理
   - 原始课程allCourses：从数据库加载的所有课程
   - 可用课程availableCourses：经筛选后符合条件的课程
   - 已选课程selectedCourses：用户确认选择的课程
2. 动态筛选算法
   - 采用分层匹配策略：先简单条件后复杂条件
   - 时间匹配采用三阶段检测：
     - 周次范围 → 星期匹配 → 节次冲突
   - 优化性能：发现不匹配立即结束检查
3. 智能冲突检测
   - 实时比对两门课程的：
     - 周次重叠检测
     - 星期一致性判断
     - 节次冲突识别
   - 可视化反馈：冲突课程自动标红提醒

## UI 界面类设计细节
### 一、choosingWindow 类
#### 功能概述
choosingWindow 类是选课系统的主窗口，整合了多个子模块，为用户提供一个完整的选课操作界面，包括课程展示、筛选、选课和查看课程表等功能。
#### 界面布局
•	顶部区域 ：设置窗口标题为 “选课窗口”，并添加背景图片，增强界面美观度。在窗口上方显示北京大学的图片，提升界面的辨识度。
•	中间区域 ：采用布局管理器将多个子模块合理排列。左侧放置筛选条件设置面板，包括教师姓名、课程名称、课程 ID、开始和结束节次、学分、周次范围、星期几等输入框和选择框；中间为主展示区域，集成 ShowList 模块展示待选课程列表和 Selected 模块展示已选课程列表；右侧放置 schedule 模块展示课程表。
•	底部区域 ：设置按钮栏，包含 “返回”、“帮助”、“保存”、“查看课表” 和 “筛选” 等按钮，方便用户进行相关操作。
#### 用户交互
•	选课操作 ：用户点击 ShowList 中的 “选择” 按钮，触发选课事件。弹出确认对话框，提示用户是否确定选择该课程。若用户确认，将课程添加到已选课程列表，并在课程表中相应位置显示该课程。
•	删课操作 ：用户点击 Selected 中的 “删除” 按钮，触发删课事件。从已选课程列表中移除该课程，并更新课程表显示。
•	筛选操作 ：用户在筛选条件设置面板中输入或选择相应的条件，点击 “筛选” 按钮，触发筛选事件。根据用户设置的条件，筛选出符合条件的课程并更新待选课程列表。
•	查看课表操作 ：点击 “查看课表” 按钮，触发查看课表事件。显示课程表窗口，用户可以直观地查看已选课程的时间安排。
•	保存操作 ：点击 “保存” 按钮，触发保存事件。弹出文件保存对话框，用户选择保存路径后，将已选课程信息保存到文件中。
•	帮助操作 ：点击 “帮助” 按钮，触发帮助事件。弹出帮助窗口，为用户提供了一份详细的选课指南。
#### 协作关系
•	包含 ShowList、Selected 和 schedule 等子模块，作为其内部组件，协同实现选课功能。
•	与 CourseManager 类协作，获取课程数据和筛选结果，更新界面显示。
•	与 helpWindow 类协作，当用户点击 “帮助” 按钮时，打开帮助窗口。
### 二、Selected 类
#### 功能概述
Selected 类用于展示已选课程的列表，并为用户提供有价值的课程信息和便捷的删除功能。
#### 界面布局
•	表格展示 ：采用 QTableWidget 创建表格，设置列名为 “删除”、“课程名称” 和 “授课教师”。表格的列宽根据内容自动调整，确保信息清晰可见。
•	删除按钮列 ：在表格的第一列放置删除按钮，每个按钮对应一门已选课程，方便用户快速删除不需要的课程。
用户交互
•	删除操作 ：用户点击表格中的 “删除” 按钮，触发删除事件。弹出确认对话框，提示用户是否确定删除该课程。若用户确认，从已选课程列表中移除该课程，并更新表格显示。
协作关系
•	与 choosingWindow 类协作，作为其内部组件展示已选课程。
•	将删除操作的结果反馈给 CourseManager 类，更新已选课程状态。
### 三、StartWindow 类
#### 功能概述
StartWindow 类是选课系统的启动窗口，为用户提供了一个简洁的开始界面，方便用户进入选课系统或查看历史选课记录。
#### 界面布局
•	窗口设置 ：设置窗口大小为固定值，防止用户随意调整窗口大小导致界面布局混乱。添加背景图片，提升界面美观度。设置窗口标题为 “开始窗口”。
•	按钮区域 ：在窗口中放置三个按钮，分别是 “开始新的选课”、“基于历史记录选课” 和 “关闭”，按钮排列整齐，方便用户操作。
#### 用户交互
•	开始新的选课操作 ：用户点击 “开始新的选课” 按钮，触发开始新的选课事件。创建一个新的 choosingWindow 对象，清空历史选课记录，进入选课界面。
•	基于历史记录选课操作 ：点击 “基于历史记录选课” 按钮，触发基于历史记录选课事件。创建一个新的 choosingWindow 对象，加载历史选课记录，进入选课界面。
•	关闭操作 ：点击 “关闭” 按钮，触发关闭事件。关闭整个应用程序。
#### 协作关系
•	与 choosingWindow 类协作，通过按钮点击事件创建或打开选课窗口。
### 四、schedule 类
#### 功能概述
schedule 类用于以表格形式展示课程表，直观呈现已选课程的时间安排，方便用户查看和管理课程时间。
#### 界面布局
•	表格创建 ：使用 QTableWidget 创建一个表格，设置列数为 7，代表周一至周日；设置行数为 13，第 0 行用于显示节次信息，第 1 至 12 行对应第 1 至第 12 节课程时间。
•	表头设置 ：设置水平表头标签为 “周一”、“周二”、“周三”、“周四”、“周五”、“周六”、“周日”，垂直表头标签为节次和对应的时间信息，使用户一目了然地了解每个时间段的课程安排。
•	样式设置 ：设置表格的样式，包括网格线颜色、背景颜色、表头样式等，提升界面美观度。设置表格的行高和列宽，确保课程信息显示完整。
•	布局管理 ：将表格添加到一个垂直布局中，并设置布局的边距，使表格在窗口中居中显示，整体布局美观。
#### 用户交互
•	课程表更新 ：根据 CourseManager 类提供的已选课程数据，动态更新课程表显示。将每门课程的名称和教室信息填入对应的表格单元格中，若同一时间段有多个课程，则显示课程名称，悬停时显示详细信息。
协作关系
•	与 choosingWindow 类协作，作为其内部组件展示课程表。
•	获取 CourseManager 类提供的已选课程数据，展示在课程表中。

### 五、helpWindow 类
#### 功能概述
helpWindow 类用于为用户提供几个帮助文档，介绍软件的功能和使用方法，帮助用户快速上手。
界面布局
•	文本显示区域 ：使用 QTextEdit 创建一个文本显示区域，设置为只读模式，防止用户随意修改帮助内容。加载并显示帮助文档内容，内容包括软件的功能介绍、操作指南、常见问题解答等。
•	布局设置 ：将文本显示区域放置在一个垂直布局中，设置布局的边距，使文本显示区域居中显示，整体布局简洁明了。
#### 协作关系
•	由 choosingWindow 类触发打开，为用户提供了一个获取帮助的途径。
### 六、ShowList 类
#### 功能概述
ShowList 类用于展示所有可供选择的课程列表，并支持高亮显示与已选课程冲突的课程，帮助用户快速筛选和选择课程。
#### 界面布局
•	表格展示 ：采用 QTableWidget 创建表格，设置列名为 “选择”、“课程号”、“课程名称”、“课程类别”、“学分”、“授课教师”、“班号”、“开课单位”、“年级”、“上课时间”、“教室”、“备注”。表格的列宽根据内容自动调整，部分列允许用户手动调整宽度，以满足不同用户的需求。
•	选择按钮列 ：在表格的第一列放置选择按钮，每个按钮对应一门课程，方便用户快速选择课程。
#### 用户交互
•	选课操作 ：用户点击表格中的 “选择” 按钮，触发选课事件。弹出确认对话框，提示用户是否确定选择该课程。若用户确认，将课程添加到已选课程列表，并在课程表中相应位置显示该课程。
•	冲突高亮显示 ：根据 CourseManager 类提供的已选课程数据，检测待选课程是否与已选课程存在时间冲突。若存在冲突，将冲突课程的文本颜色设置为红色，提醒用户注意。
#### 协作关系
•	与 choosingWindow 类协作，作为其内部组件展示待选课程。
•	获取 CourseManager 类提供的可用课程列表进行展示。

# 三、分工情况

1. 路莎莎：数据结构和数据输入部分，即course和courseRepository，以及choosingwindow的关于已选课程学分显示的功能部分
2. 刘毅：课程筛选的逻辑部分，即coursemanager和filter
3. 马凯翔：ui，即choosingwindow,seleceted,startwindow,schedule,helpwindow,showlist

Ps:后期debug三人均有参与

# 四、项目总结与反思
1. 最开始没有使用同一个开发平台（最开始刘和路使用的是vs），迁移到qt上出现了适配性的问题
2. 对于大项目没有合作同步开发的经验，多个版本容易混淆
3. 不知道怎么去规划类的设计是最合理的，前期开发很慢


